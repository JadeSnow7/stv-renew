openapi: 3.0.3
info:
  title: StoryToVideo Renew API
  version: "1.0.0"
servers:
  - url: http://localhost:8080
paths:
  /api/v1/healthz:
    get:
      summary: Health check
      responses:
        "200":
          description: OK
  /api/v1/auth/login:
    post:
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        "200": { description: OK }
  /api/v1/auth/refresh:
    post:
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token: { type: string }
      responses:
        "200": { description: OK }
  /api/v1/auth/logout:
    post:
      summary: Logout
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: OK }
  /api/v1/me:
    get:
      summary: Current user
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: OK }
  /api/v1/client/bootstrap:
    get:
      summary: Client bootstrap config
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: OK }
  /api/v1/projects:
    post:
      summary: Create project
      security: [{ bearerAuth: [] }]
      responses:
        "201": { description: Created }
    get:
      summary: List projects
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: page_size
          schema: { type: integer }
      responses:
        "200": { description: OK }
  /api/v1/projects/{project_id}:
    get:
      summary: Get project
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        "200": { description: OK }
    patch:
      summary: Update project
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        "200": { description: OK }
  /api/v1/projects/{project_id}/storyboard:
    get:
      summary: Get storyboard
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        "200": { description: OK }
    put:
      summary: Replace storyboard
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        "200": { description: OK }
  /api/v1/projects/{project_id}/storyboard/scenes/{scene_id}:
    patch:
      summary: Patch scene
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/projectId"
        - in: path
          name: scene_id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
  /api/v1/projects/{project_id}/jobs:
    post:
      summary: Start job
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        "201": { description: Created }
  /api/v1/jobs/{job_id}:
    get:
      summary: Get job status
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/jobId"
      responses:
        "200": { description: OK }
  /api/v1/jobs/{job_id}/cancel:
    post:
      summary: Cancel job
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/jobId"
      responses:
        "200": { description: OK }
  /api/v1/jobs/{job_id}/retry:
    post:
      summary: Retry job
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/jobId"
      responses:
        "200": { description: OK }
  /api/v1/jobs/{job_id}/events:
    get:
      summary: SSE stream for job events
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/jobId"
      responses:
        "200":
          description: text/event-stream
          content:
            text/event-stream:
              schema:
                type: string
  /api/v1/assets:
    get:
      summary: List assets
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: project_id
          schema: { type: string }
        - in: query
          name: type
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer }
        - in: query
          name: page_size
          schema: { type: integer }
      responses:
        "200": { description: OK }
  /api/v1/assets/{asset_id}:
    get:
      summary: Get asset
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: asset_id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
  /api/v1/projects/{project_id}/export:
    post:
      summary: Create export
      security: [{ bearerAuth: [] }]
      parameters:
        - $ref: "#/components/parameters/projectId"
      responses:
        "202": { description: Accepted }
  /api/v1/exports/{export_id}:
    get:
      summary: Get export
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: export_id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
  /api/v1/exports/{export_id}/download-url:
    get:
      summary: Get export download url
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: export_id
          required: true
          schema: { type: string }
      responses:
        "200": { description: OK }
components:
  parameters:
    projectId:
      in: path
      name: project_id
      required: true
      schema: { type: string }
    jobId:
      in: path
      name: job_id
      required: true
      schema: { type: string }
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
