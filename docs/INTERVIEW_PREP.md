# StoryToVideo Renew - è…¾è®¯ PC å®¢æˆ·ç«¯é¢è¯•å‡†å¤‡æ–‡æ¡£

> **ç›®æ ‡å²—ä½**ï¼šè…¾è®¯ WXGï¼ˆå¾®ä¿¡äº‹ä¸šç¾¤ï¼‰PC å®¢æˆ·ç«¯å¼€å‘ï¼ˆC++ï¼‰
> **å‡†å¤‡æ—¶é—´**ï¼š72 å°æ—¶çªå‡»ç‰ˆ
> **æœ€åæ›´æ–°**ï¼š2026-02-15

---

## ğŸ“‹ ç›®å½•

- [Part 1: P0 æ ¸å¿ƒæ¦‚å¿µï¼ˆå¿…é¡»æŒæ¡ï¼‰](#part-1-p0-æ ¸å¿ƒæ¦‚å¿µ)
  - [1.1 å¼‚å¸¸å®‰å…¨ä¸é”™è¯¯å¤„ç†](#11-å¼‚å¸¸å®‰å…¨ä¸é”™è¯¯å¤„ç†)
  - [1.2 æ™ºèƒ½æŒ‡é’ˆçº¿ç¨‹å®‰å…¨](#12-æ™ºèƒ½æŒ‡é’ˆçº¿ç¨‹å®‰å…¨)
  - [1.3 å¤šçº¿ç¨‹åŸºç¡€](#13-å¤šçº¿ç¨‹åŸºç¡€)
  - [1.4 C++ æ—¶é—´åº“ chrono](#14-c-æ—¶é—´åº“-chrono)
- [Part 2: é¡¹ç›®ç›¸å…³é¢è¯•é¢˜](#part-2-é¡¹ç›®ç›¸å…³é¢è¯•é¢˜)
  - [2.1 é‡æ„åŠ¨æœºä¸æ”¶ç›Š](#21-é‡æ„åŠ¨æœºä¸æ”¶ç›Š)
  - [2.2 è½®è¯¢ vs äº‹ä»¶é©±åŠ¨](#22-è½®è¯¢-vs-äº‹ä»¶é©±åŠ¨)
  - [2.3 RetryableHttpClient æ·±æŒ–](#23-retryablehttpclient-æ·±æŒ–)
- [Part 3: å…«è‚¡å¿«é—®å¿«ç­”](#part-3-å…«è‚¡å¿«é—®å¿«ç­”)
- [Part 4: 72å°æ—¶å¤ä¹ è®¡åˆ’](#part-4-72å°æ—¶å¤ä¹ è®¡åˆ’)

---

## Part 1: P0 æ ¸å¿ƒæ¦‚å¿µ

### 1.1 å¼‚å¸¸å®‰å…¨ä¸é”™è¯¯å¤„ç†

#### ğŸ¯ æ ¸å¿ƒè€ƒç‚¹

**Q: ä¸ºä»€ä¹ˆç”¨ `std::from_chars` è€Œä¸æ˜¯ `std::stoi`ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼ˆ95åˆ†ç‰ˆæœ¬ï¼‰ï¼š**

> "æˆ‘ç”¨ `from_chars` è€Œä¸æ˜¯ `stoi`ï¼Œä¸»è¦åŸºäºä¸‰ä¸ªåŸå› ï¼š
>
> **1. å¼‚å¸¸å®‰å…¨**
> - `stoi` åœ¨é‡åˆ°éæ³•è¾“å…¥æ—¶ä¼šæŠ›å¼‚å¸¸ï¼ˆ`std::invalid_argument` æˆ– `std::out_of_range`ï¼‰
> - å¼‚å¸¸æœ‰æ€§èƒ½å¼€é”€ï¼šæ„é€ å¼‚å¸¸å¯¹è±¡ã€æ ˆå±•å¼€
> - `from_chars` æ˜¯ C++17 å¼•å…¥çš„æ— å¼‚å¸¸æ¥å£ï¼Œè¿”å› `std::from_chars_result` ç»“æ„ä½“ï¼š
>   ```cpp
>   struct from_chars_result {
>       const char* ptr;  // æŒ‡å‘ç¬¬ä¸€ä¸ªæœªè§£æå­—ç¬¦
>       std::errc ec;     // é”™è¯¯ç ï¼ˆstd::errc{} è¡¨ç¤ºæˆåŠŸï¼‰
>   };
>   ```
>   åªéœ€æ£€æŸ¥ `ec == std::errc()`ï¼Œæ— å¼‚å¸¸å¼€é”€
>
> **2. æ€§èƒ½ä¼˜åŠ¿**
> - `stoi` æœ‰ä¸¤ä¸ªéšè—å¼€é”€ï¼š
>   - **Locale ä¾èµ–**ï¼šæŸ¥è¯¢å…¨å±€ locale è®¾ç½®ï¼ˆåƒä½åˆ†éš”ç¬¦ï¼‰ï¼Œæœ‰çº¿ç¨‹åŒæ­¥æˆæœ¬
>   - **å­—ç¬¦ä¸²æ„é€ **ï¼šå‚æ•°æ˜¯ `std::string`ï¼Œå¯èƒ½è§¦å‘å†…å­˜åˆ†é…
> - `from_chars` æ˜¯é›¶å¼€é”€æŠ½è±¡ï¼š
>   - æ—  locale ä¾èµ–
>   - ç›´æ¥æ“ä½œ `const char*`ï¼Œæ— å†…å­˜åˆ†é…
>   - ç¼–è¯‘å™¨å¯ä»¥å®Œå…¨å†…è”ä¼˜åŒ–
>
> **3. å®‰å…¨æ€§**
> - `stoi` æœ‰éšè—çš„å‘ï¼š
>   ```cpp
>   std::stoi("123abc");  // è¿”å› 123ï¼Œä¸æŠ¥é”™ï¼æ®‹ç•™çš„ "abc" è¢«å¿½ç•¥
>   ```
> - `from_chars` å¯ä»¥æ£€æµ‹æ®‹ç•™å­—ç¬¦ï¼š
>   ```cpp
>   auto [ptr, ec] = std::from_chars(begin, end, x);
>   if (ec == std::errc() && ptr == end) {
>       // å®Œå…¨è§£æï¼Œæ— æ®‹ç•™
>   }
>   ```
>
> **æ€»ç»“ï¼š** `from_chars` æ˜¯ç°ä»£ C++ çš„æ¨èæ–¹å¼ï¼Œå¼‚å¸¸å®‰å…¨ã€æ€§èƒ½å¥½ã€å¯é æ€§é«˜ã€‚å”¯ä¸€ç¼ºç‚¹æ˜¯ C++17 æ‰æ”¯æŒã€‚"

#### ğŸ“ å¯¹æ¯”è¡¨ï¼ˆå¿…èƒŒï¼‰

| ç‰¹æ€§ | `std::from_chars` (C++17) | `std::stoi` |
|------|---------------------------|-------------|
| **å¼‚å¸¸** | âŒ ä¸æŠ›å¼‚å¸¸ï¼ˆè¿”å› `std::errc`ï¼‰ | âœ… æŠ›å¼‚å¸¸ï¼ˆ`invalid_argument` / `out_of_range`ï¼‰ |
| **æ€§èƒ½** | âš¡ é›¶å¼€é”€ï¼Œæ—  locale ä¾èµ– | ğŸ¢ æœ‰ locale æŸ¥è¯¢ï¼Œå­—ç¬¦ä¸²æ„é€ å¼€é”€ |
| **æ®‹ç•™æ£€æµ‹** | âœ… `ptr == end` å¯æ£€æµ‹ | âŒ å¿½ç•¥æ®‹ç•™å­—ç¬¦ |
| **è¾“å…¥ç±»å‹** | `const char*` æŒ‡é’ˆ | `std::string`ï¼ˆå¯èƒ½åˆ†é…å†…å­˜ï¼‰ |
| **ä½¿ç”¨åœºæ™¯** | é«˜æ€§èƒ½è§£æã€åè®®å¤„ç† | ç®€å•è„šæœ¬ã€éå…³é”®è·¯å¾„ |

#### ğŸ’» å¿…å†™ä»£ç ï¼ˆ5åˆ†é’Ÿé»˜å†™ï¼‰

```cpp
#include <charconv>
#include <string>
#include <iostream>

// âœ… æ­£ç¡®ä½¿ç”¨ from_chars
void parse_http_code_safe(const std::string& str) {
    int code = 0;
    auto [ptr, ec] = std::from_chars(str.data(), str.data() + str.size(), code);

    if (ec == std::errc()) {
        if (ptr == str.data() + str.size()) {
            std::cout << "å®Œå…¨è§£æ: " << code << "\n";
        } else {
            std::cout << "æœ‰æ®‹ç•™å­—ç¬¦\n";
        }
    } else if (ec == std::errc::invalid_argument) {
        std::cout << "éæ³•æ ¼å¼\n";
    } else if (ec == std::errc::result_out_of_range) {
        std::cout << "æº¢å‡º\n";
    }
}

// âŒ stoi çš„é™·é˜±
void stoi_trap() {
    std::cout << std::stoi("123abc") << "\n";  // è¾“å‡º 123ï¼ˆä¸æŠ¥é”™ï¼ï¼‰

    try {
        std::stoi("abc");  // æŠ›å¼‚å¸¸
    } catch (const std::invalid_argument& e) {
        std::cout << "å¼‚å¸¸: " << e.what() << "\n";
    }
}
```

#### âš ï¸ æ˜“é”™ç‚¹

1. **æ¦‚å¿µæå**ï¼š`from_chars` æ˜¯"ä¸æŠ›å¼‚å¸¸"ï¼Œä¸æ˜¯"è¿”å›å¼‚å¸¸"
2. **å¿˜è®°æ£€æŸ¥æ®‹ç•™**ï¼š`ptr == end` æ‰è¡¨ç¤ºå®Œå…¨è§£æ
3. **è¾¹ç•Œæ¡ä»¶**ï¼šæº¢å‡ºæ—¶ `ec == std::errc::result_out_of_range`

---

### 1.2 æ™ºèƒ½æŒ‡é’ˆçº¿ç¨‹å®‰å…¨

#### ğŸ¯ æ ¸å¿ƒè€ƒç‚¹

**Q: `shared_ptr` çš„å¼•ç”¨è®¡æ•°æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿå¤šçº¿ç¨‹å¯ä»¥éšä¾¿ç”¨å—ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼ˆ95åˆ†ç‰ˆæœ¬ï¼‰ï¼š**

> "`shared_ptr` çš„çº¿ç¨‹å®‰å…¨æ€§éœ€è¦åˆ†ä¸‰å±‚ç†è§£ï¼š
>
> **ç¬¬ä¸€å±‚ï¼šæ§åˆ¶å—ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰æ˜¯çº¿ç¨‹å®‰å…¨çš„**
> - å†…éƒ¨ç”¨ `std::atomic<int>` å®ç°
> - å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‹·è´ã€ææ„**ä¸åŒçš„ `shared_ptr` å®ä¾‹**ï¼ˆæŒ‡å‘åŒä¸€å¯¹è±¡ï¼‰æ˜¯å®‰å…¨çš„
> - ä¾‹å¦‚ï¼šçº¿ç¨‹ A æ‰§è¡Œ `p1.reset()`ï¼Œçº¿ç¨‹ B æ‰§è¡Œ `p2 = p1`ï¼Œä¸éœ€è¦é¢å¤–åŒæ­¥
>
> **ç¬¬äºŒå±‚ï¼šshared_ptr å¯¹è±¡æœ¬èº«ä¸ä¿è¯çº¿ç¨‹å®‰å…¨**
> - å¦‚æœå¤šçº¿ç¨‹è¯»å†™**åŒä¸€ä¸ª `shared_ptr` å®ä¾‹**ï¼Œéœ€è¦åŠ é”
> - ä¾‹å¦‚ï¼šå…¨å±€ `shared_ptr<Foo> global_ptr`ï¼Œçº¿ç¨‹ A æ‰§è¡Œ `global_ptr.reset()`ï¼Œçº¿ç¨‹ B æ‰§è¡Œ `global_ptr = make_shared<Foo>()`ï¼Œä¼šæœ‰ç«æ€æ¡ä»¶
> - åŸå› ï¼šèµ‹å€¼æ“ä½œåŒ…å«å¤šæ­¥ï¼ˆè¯»æ—§æŒ‡é’ˆã€å‡è®¡æ•°ã€å†™æ–°æŒ‡é’ˆã€å¢è®¡æ•°ï¼‰ï¼Œä¸æ˜¯åŸå­çš„
>
> **ç¬¬ä¸‰å±‚ï¼šç®¡ç†çš„å¯¹è±¡ä¸ä¿è¯çº¿ç¨‹å®‰å…¨**
> - `shared_ptr<vector<int>> p` ä¸­ï¼Œ`vector` æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„
> - å¤šçº¿ç¨‹è°ƒç”¨ `p->push_back()` éœ€è¦åŠ é”
>
> **æ€»ç»“ï¼šå¼•ç”¨è®¡æ•°å®‰å…¨ â‰  shared_ptr å®ä¾‹å®‰å…¨ â‰  ç®¡ç†çš„å¯¹è±¡å®‰å…¨**
>
> **å®é™…åº”ç”¨ï¼š** åœ¨æˆ‘çš„ä»£ç ä¸­ï¼Œ`cancel_token` æ˜¯ `shared_ptr<CancelToken>`ï¼Œå¤šçº¿ç¨‹è¯»å®ƒæ˜¯å®‰å…¨çš„ï¼ˆæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å±€éƒ¨å‰¯æœ¬ï¼‰ï¼Œä½†å¦‚æœè¦ä¿®æ”¹æŒ‡å‘çš„å¯¹è±¡ï¼ˆå¦‚å…¨å±€æ›¿æ¢ `cancel_token`ï¼‰ï¼Œéœ€è¦åŠ é”ã€‚"

#### ğŸ“ ä¸‰å±‚æ¨¡å‹ï¼ˆå¿…èƒŒï¼‰

```
Layer 1: æ§åˆ¶å—ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰        âœ… çº¿ç¨‹å®‰å…¨ï¼ˆatomicï¼‰
Layer 2: shared_ptr å¯¹è±¡æœ¬èº«       âŒ ä¸ä¿è¯çº¿ç¨‹å®‰å…¨
Layer 3: ç®¡ç†çš„å¯¹è±¡ï¼ˆT*ï¼‰          âŒ ä¸ä¿è¯çº¿ç¨‹å®‰å…¨
```

#### ğŸ’» å¿…å†™ä»£ç ï¼ˆ5åˆ†é’Ÿé»˜å†™ï¼‰

```cpp
#include <memory>
#include <thread>
#include <mutex>

// âœ… å®‰å…¨åœºæ™¯ï¼šå¤šçº¿ç¨‹æ“ä½œä¸åŒçš„ shared_ptr å®ä¾‹
void safe_scenario() {
    auto p = std::make_shared<int>(42);

    std::thread t1([p]() { auto copy = p; });  // âœ… æ‹·è´ï¼Œå¼•ç”¨è®¡æ•°åŸå­é€’å¢
    std::thread t2([p]() { auto local = p; }); // âœ… å®‰å…¨

    t1.join(); t2.join();
}

// âŒ å±é™©åœºæ™¯ï¼šå¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ª shared_ptr å®ä¾‹
std::shared_ptr<int> global_ptr = std::make_shared<int>(42);

void unsafe_scenario() {
    std::thread t1([]() {
        global_ptr.reset();  // âŒ ç«æ€æ¡ä»¶ï¼
    });

    std::thread t2([]() {
        global_ptr = std::make_shared<int>(100);  // âŒ ç«æ€æ¡ä»¶ï¼
    });

    t1.join(); t2.join();
}

// âœ… ä¿®å¤ï¼šåŠ é”
std::mutex mtx;
void safe_with_lock() {
    std::thread t1([]() {
        std::lock_guard<std::mutex> lock(mtx);
        global_ptr.reset();
    });

    std::thread t2([]() {
        std::lock_guard<std::mutex> lock(mtx);
        global_ptr = std::make_shared<int>(100);
    });

    t1.join(); t2.join();
}
```

#### âš ï¸ é¢è¯•é™·é˜±

**é¢è¯•å®˜è¿½é—®ï¼š** "é‚£æ˜¯ä¸æ˜¯è¯´å¤šçº¿ç¨‹å¯ä»¥éšä¾¿ç”¨ shared_ptrï¼Œä¸éœ€è¦åŠ é”ï¼Ÿ"

**é”™è¯¯å›ç­”ï¼š** "æ˜¯çš„"ï¼ˆâŒ ç›´æ¥æŒ‚æ‰ï¼‰

**æ­£ç¡®å›ç­”ï¼š** "ä¸æ˜¯ã€‚åªæœ‰åœ¨å¤šçº¿ç¨‹æ“ä½œ**ä¸åŒçš„ shared_ptr å®ä¾‹**æ—¶æ‰å®‰å…¨ã€‚å¦‚æœå¤šçº¿ç¨‹è¯»å†™**åŒä¸€ä¸ªå®ä¾‹**ï¼ˆå¦‚å…¨å±€å˜é‡ï¼‰ï¼Œä»ç„¶éœ€è¦åŠ é”ã€‚"

---

### 1.3 å¤šçº¿ç¨‹åŸºç¡€

#### ğŸ¯ æ ¸å¿ƒè€ƒç‚¹

**Q: ä½ çš„ä»£ç ä¸­ `printf` æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜å—ï¼Ÿå¦‚ä½•ä¿®å¤ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼ˆ90åˆ†ç‰ˆæœ¬ï¼‰ï¼š**

> "ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚`printf` ä¸æ˜¯åŸå­æ“ä½œï¼Œå¤šçº¿ç¨‹åŒæ—¶è°ƒç”¨ä¼šå¯¼è‡´**è¾“å‡ºæ··ä¹±ï¼ˆinterleavingï¼‰**ã€‚
>
> **å…·ä½“è¡¨ç°ï¼š**
> - çº¿ç¨‹ A è¾“å‡º `[trace_id_1] Retry attempt 1/3` è¾“å‡ºåˆ°ä¸€åŠ
> - çº¿ç¨‹ B æ’å…¥è¾“å‡º `[trace_id_2] Retry attempt 2/3`
> - æœ€ç»ˆæ—¥å¿—å˜æˆï¼š`[trace[trace_id_1] _id_2] Retry Retry attempt attempt 1/32/3`
> - å®Œå…¨ä¸å¯è¯»ï¼Œgrep æ— æ³•è¿‡æ»¤
>
> **è§£å†³æ–¹æ¡ˆæœ‰ä¸‰ä¸ªï¼š**
>
> **æ–¹æ¡ˆ1ï¼ˆä¸´æ—¶ï¼‰ï¼šåŠ äº’æ–¥é”**
> ```cpp
> static std::mutex log_mutex;
> {
>     std::lock_guard<std::mutex> lock(log_mutex);
>     printf("[%s] Retry attempt %d/%d, backoff=%ldms\n", ...);
> }
> ```
> ä¼˜ç‚¹ï¼šæœ€å¿«ï¼Œä¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“
> ç¼ºç‚¹ï¼šé”ç«äº‰ä¼šå½±å“æ€§èƒ½ï¼ŒM3 é«˜å¹¶å‘æ—¶å¯èƒ½æˆä¸ºç“¶é¢ˆ
>
> **æ–¹æ¡ˆ2ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨ spdlog**
> ```cpp
> spdlog::info("[{}] Retry attempt {}/{}, backoff={}ms",
>              request.trace_id, attempt + 1, policy_.max_retries, backoff.count());
> ```
> ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ã€é«˜æ€§èƒ½ï¼ˆå¼‚æ­¥å†™å…¥ï¼‰ã€æ”¯æŒç»“æ„åŒ–æ—¥å¿—
> ç¼ºç‚¹ï¼šéœ€è¦ä¾èµ– spdlogï¼ˆä½†é¡¹ç›®å·²ç»åœ¨ç”¨ï¼‰
>
> **æ–¹æ¡ˆ3ï¼ˆç»ˆæï¼‰ï¼šæ— é”æ—¥å¿—åº“ï¼ˆå¦‚ NanoLogï¼‰**
> ä¼˜ç‚¹ï¼šå‡ ä¹é›¶å¼€é”€
> ç¼ºç‚¹ï¼šå¤æ‚ï¼Œè¿‡åº¦è®¾è®¡
>
> **æˆ‘çš„é€‰æ‹©ï¼šM2 é˜¶æ®µå…ˆç”¨æ–¹æ¡ˆ1åŠ é”ä¸´æ—¶ä¿®å¤ï¼ŒM2 åæœŸç»Ÿä¸€æ›¿æ¢ä¸º spdlogï¼ˆæ–¹æ¡ˆ2ï¼‰ã€‚**
>
> **printf ä¸çº¿ç¨‹å®‰å…¨çš„æ ¹æœ¬åŸå› ï¼š**
> - `printf` å†…éƒ¨æœ‰å¤šæ¬¡ç³»ç»Ÿè°ƒç”¨ï¼ˆ`write`ï¼‰å’Œç¼“å†²åŒºæ“ä½œ
> - æ ‡å‡†åº“ä¸ä¿è¯è¿™äº›æ“ä½œçš„åŸå­æ€§
> - å¤šçº¿ç¨‹åŒæ—¶å†™æ—¶ï¼Œç¼“å†²åŒºçŠ¶æ€ä¼šé”™ä¹±"

#### ğŸ“ ä¸‰ç§é”å¯¹æ¯”ï¼ˆå¿…èƒŒï¼‰

| ç±»å‹ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `std::mutex` | æ‰‹åŠ¨ lock/unlock | âŒ ä¸æ¨èï¼ˆå®¹æ˜“å¿˜è®° unlockï¼‰ |
| `std::lock_guard` | RAIIï¼Œè‡ªåŠ¨ unlockï¼Œä¸å¯æå‰é‡Šæ”¾ | âœ… ç®€å•ä¸´ç•ŒåŒº |
| `std::unique_lock` | RAIIï¼Œå¯æå‰ unlockï¼Œå¯é…åˆ condition_variable | âœ… å¤æ‚åœºæ™¯ï¼ˆå¦‚æ¡ä»¶å˜é‡ï¼‰ |

#### ğŸ’» å¿…å†™ä»£ç ï¼ˆ5åˆ†é’Ÿé»˜å†™ï¼‰

```cpp
#include <mutex>
#include <iostream>
#include <thread>

std::mutex log_mutex;

// âŒ ä¸å®‰å…¨çš„æ—¥å¿—
void unsafe_log(const std::string& msg) {
    std::cout << "[Thread] " << msg << "\n";  // ä¼šæ··ä¹±
}

// âœ… å®‰å…¨çš„æ—¥å¿—ï¼ˆlock_guardï¼‰
void safe_log_v1(const std::string& msg) {
    std::lock_guard<std::mutex> lock(log_mutex);
    std::cout << "[Thread] " << msg << "\n";
}  // lock è‡ªåŠ¨é‡Šæ”¾

// âœ… å®‰å…¨çš„æ—¥å¿—ï¼ˆunique_lockï¼Œå¯æå‰é‡Šæ”¾ï¼‰
void safe_log_v2(const std::string& msg) {
    std::unique_lock<std::mutex> lock(log_mutex);
    std::cout << "[Thread] " << msg << "\n";
    lock.unlock();  // å¯ä»¥æå‰é‡Šæ”¾

    // åšå…¶ä»–ä¸éœ€è¦é”çš„äº‹
}

// æµ‹è¯•æ··ä¹±è¾“å‡º
void test_interleaving() {
    std::thread t1([]() {
        for (int i = 0; i < 5; ++i) unsafe_log("Thread 1");
    });
    std::thread t2([]() {
        for (int i = 0; i < 5; ++i) unsafe_log("Thread 2");
    });
    t1.join(); t2.join();
}
```

---

### 1.4 C++ æ—¶é—´åº“ chrono

#### ğŸ¯ æ ¸å¿ƒè€ƒç‚¹

**Q: ä¸ºä»€ä¹ˆç”¨ `steady_clock` è€Œä¸æ˜¯ `system_clock`ï¼ŸæŒ‡æ•°é€€é¿è®¡ç®—ä¸ºä»€ä¹ˆéœ€è¦ `duration_cast`ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼ˆ90åˆ†ç‰ˆæœ¬ï¼‰ï¼š**

> "æˆ‘ç”¨ `steady_clock` è€Œä¸æ˜¯ `system_clock`ï¼Œå› ä¸ºï¼š
>
> **steady_clock ç‰¹ç‚¹ï¼š**
> - **å•è°ƒé€’å¢**ï¼šä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“ï¼ˆç”¨æˆ·æ”¹æ—¶é—´ã€NTP åŒæ­¥ï¼‰
> - é€‚åˆæµ‹é‡æ—¶é—´é—´éš”ï¼ˆæ€§èƒ½è®¡æ—¶ã€è¶…æ—¶åˆ¤æ–­ï¼‰
>
> **system_clock ç‰¹ç‚¹ï¼š**
> - å¯èƒ½è·³å˜ï¼ˆç”¨æˆ·æ”¹ç³»ç»Ÿæ—¶é—´ï¼Œæˆ– NTP åŒæ­¥ï¼‰
> - é€‚åˆè·å–å¢™ä¸Šæ—¶é’Ÿæ—¶é—´ï¼ˆæ—¥å¿—æ—¶é—´æˆ³ã€æ˜¾ç¤ºç»™ç”¨æˆ·ï¼‰
>
> **ä¸ºä»€ä¹ˆéœ€è¦ duration_castï¼š**
> ```cpp
> std::chrono::milliseconds backoff(1000);  // duration<int64_t, milli>
> auto new_backoff = backoff * 2.0;         // duration<double, milli>ï¼ˆç±»å‹å˜äº†ï¼ï¼‰
>
> // std::min è¦æ±‚ä¸¤å‚æ•°ç±»å‹å®Œå…¨ä¸€è‡´ï¼Œéœ€è¦è½¬å› milliseconds
> backoff = std::min(
>     duration_cast<milliseconds>(new_backoff),  // è½¬å› duration<int64_t>
>     max_backoff
> );
> ```
>
> **å®é™…åº”ç”¨ï¼š** åœ¨åˆ†ç‰‡ sleep ä¸­ï¼Œæˆ‘ç”¨ `steady_clock::now()` è®¡ç®—ç›®æ ‡æ—¶é—´ç‚¹ï¼Œé¿å…ç³»ç»Ÿæ—¶é—´è·³å˜å¯¼è‡´è¶…æ—¶åˆ¤æ–­é”™è¯¯ã€‚"

#### ğŸ“ ä¸¤ç§æ—¶é’Ÿå¯¹æ¯”ï¼ˆå¿…èƒŒï¼‰

| æ—¶é’Ÿ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| `steady_clock` | âœ… å•è°ƒé€’å¢ï¼Œä¸å—ç³»ç»Ÿæ—¶é—´è°ƒæ•´å½±å“ | æµ‹é‡æ—¶é—´é—´éš”ï¼ˆæ€§èƒ½è®¡æ—¶ã€è¶…æ—¶ï¼‰ |
| `system_clock` | âŒ å¯èƒ½è·³å˜ï¼ˆç”¨æˆ·æ”¹ç³»ç»Ÿæ—¶é—´ï¼‰ | è·å–å¢™ä¸Šæ—¶é’Ÿæ—¶é—´ï¼ˆæ—¥å¿—æ—¶é—´æˆ³ï¼‰ |

#### ğŸ’» å¿…å†™ä»£ç ï¼ˆ5åˆ†é’Ÿé»˜å†™ï¼‰

```cpp
#include <chrono>
#include <iostream>
#include <thread>

using namespace std::chrono;

// æŒ‡æ•°é€€é¿è®¡ç®—
void backoff_calculation() {
    milliseconds backoff(1000);
    double multiplier = 2.0;
    milliseconds max_backoff(30000);

    std::cout << "Backoff sequence:\n";
    for (int i = 0; i < 5; ++i) {
        std::cout << "Attempt " << i << ": " << backoff.count() << "ms\n";

        // è®¡ç®—ä¸‹ä¸€æ¬¡é€€é¿ï¼ˆç±»å‹ï¼šduration<double, milli>ï¼‰
        auto new_backoff = duration_cast<milliseconds>(backoff * multiplier);
        backoff = std::min(new_backoff, max_backoff);
    }
    // è¾“å‡ºï¼š1000, 2000, 4000, 8000, 16000, 30000 (capped)
}

// æµ‹é‡æ—¶é—´é—´éš”ï¼ˆç”¨ steady_clockï¼‰
void measure_elapsed() {
    auto start = steady_clock::now();

    // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    std::this_thread::sleep_for(milliseconds(500));

    auto end = steady_clock::now();
    auto elapsed = duration_cast<milliseconds>(end - start);
    std::cout << "Elapsed: " << elapsed.count() << "ms\n";
}

// âŒ é”™è¯¯ç¤ºä¾‹ï¼šç”¨ system_clock ä¼šæœ‰é—®é¢˜
void wrong_timeout_check() {
    auto deadline = system_clock::now() + seconds(10);

    // å¦‚æœç”¨æˆ·åœ¨è¿™æœŸé—´è°ƒæ•´äº†ç³»ç»Ÿæ—¶é—´ï¼Œdeadline ä¼šé”™è¯¯ï¼
    while (system_clock::now() < deadline) {
        // ...
    }
}
```

---

## Part 2: é¡¹ç›®ç›¸å…³é¢è¯•é¢˜

### 2.1 é‡æ„åŠ¨æœºä¸æ”¶ç›Š

**Q: è¿™ä¸ªé‡æ„çš„æƒ³æ³•æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Ÿä¸ºä»€ä¹ˆä¸åœ¨åŸæœ‰ä»£ç ä¸Šä¿®ä¿®è¡¥è¡¥ï¼Œè€Œæ˜¯é€‰æ‹©é‡æ„ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼ˆ90åˆ†ç‰ˆæœ¬ï¼‰ï¼š**

> "è¿™ä¸ªé‡æ„é¡¹ç›®ä¸»è¦åŸºäºä¸‰ä¸ªåŸå› ï¼š
>
> **ç¬¬ä¸€ï¼ŒæŠ€æœ¯å€ºåŠ¡é‡åŒ–åå‘ç°å¿…é¡»é‡æ„ã€‚** æˆ‘å¯¹æ—§ç‰ˆåšäº†ä»£ç å®¡æŸ¥ï¼Œå‘ç°å‡ ä¸ªä¸¥é‡é—®é¢˜ï¼š
> - ViewModel 650 è¡Œä¸Šå¸å¯¹è±¡ï¼Œæ··åˆç½‘ç»œ/çŠ¶æ€/æŒä¹…åŒ–ï¼Œå•æµ‹è¦†ç›–ç‡ä¸åˆ° 10%
> - 1 ç§’è½®è¯¢ active tasksï¼Œ50 å¹¶å‘æ—¶ CPU å  15%ï¼Œå“åº”å»¶è¿Ÿæœ€å¤š 1 ç§’
> - æ— å–æ¶ˆæœºåˆ¶ï¼Œç”¨æˆ·ç‚¹åœæ­¢åä»»åŠ¡ä»åœ¨åå°è·‘
> - æ— ç»“æ„åŒ–é”™è¯¯å¤„ç†ï¼Œå…¨éƒ¨ `QString errorMsg`ï¼Œæ— æ³•å½’å› 
>
> **ç¬¬äºŒï¼Œå®ä¹ æœŸé—´æˆ‘ä¸»è¦è´Ÿè´£ UI å±‚ï¼Œå¯¹è°ƒåº¦ã€çŠ¶æ€æœºã€é”™è¯¯å¤„ç†ç†è§£ä¸æ·±ã€‚** é‡æ„æ˜¯ä¸ªç³»ç»Ÿæ€§å­¦ä¹ çš„æœºä¼šï¼Œèƒ½è¡¥é½è¿™äº›åº•å±‚æ¨¡å—çš„çŸ¥è¯†ã€‚
>
> **ç¬¬ä¸‰ï¼Œæƒ³ä»¥é¢è¯•æ ‡å‡†é‡æ–°å®ç°ï¼Œäº§å‡ºå¯è®²ã€å¯æµ‹ã€å¯å¤ç°çš„å·¥ç¨‹æˆæœã€‚** æ–°æ¶æ„é‡‡ç”¨äº‹ä»¶é©±åŠ¨ + çŠ¶æ€æœºï¼Œå¸¦æ¥å‡ ä¸ªæ˜æ˜¾æ”¹è¿›ï¼š
> - **å¯æµ‹è¯•æ€§**ï¼šcore æ¨¡å—é›¶ Qt ä¾èµ–ï¼Œå•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 85%ï¼ˆ36 ä¸ªæµ‹è¯•å…¨é€šè¿‡ï¼‰
> - **æ€§èƒ½**ï¼šçŠ¶æ€æœºé©±åŠ¨æ›¿ä»£è½®è¯¢ï¼ŒCPU å ç”¨ä¸‹é™åˆ° 2%ï¼Œå“åº”å»¶è¿Ÿé™åˆ°æ¯«ç§’çº§
> - **å¯ç»´æŠ¤æ€§**ï¼šæ–°å¢ä¸€ä¸ª Stage åªéœ€å®ç° IStage æ¥å£ï¼Œä¸å½±å“å…¶ä»–æ¨¡å—
> - **å¯è§‚æµ‹æ€§**ï¼štrace_id è´¯ç©¿å…¨é“¾è·¯ï¼Œé”™è¯¯å¯å½’å› åˆ°å…·ä½“ task/stage
>
> é¡ºå¸¦è¯´æ˜ä¸€ä¸‹ï¼Œè¿™æ ·ä¹Ÿé¿å…äº†ç›´æ¥ç”¨å®ä¹ ä»£ç å¯èƒ½æ¶‰åŠçš„çŸ¥è¯†äº§æƒé—®é¢˜ã€‚"

#### ğŸ“Š é‡æ„å‰åå¯¹æ¯”ï¼ˆå¿…èƒŒæ•°æ®ï¼‰

| æŒ‡æ ‡ | æ—§ç‰ˆï¼ˆè½®è¯¢ï¼‰ | æ–°ç‰ˆï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰ | æ”¹è¿› |
|------|-------------|----------------|------|
| CPU å ç”¨ | 15%ï¼ˆ50å¹¶å‘ï¼‰ | 2% | â†“ 87% |
| å“åº”å»¶è¿Ÿ | æœ€å¤š 1s | æ¯«ç§’çº§ | â†“ 99% |
| å•æµ‹è¦†ç›–ç‡ | <10% | 85% | â†‘ 750% |
| ViewModel LOC | 650 è¡Œ | æ‹†åˆ†ä¸ºå¤šæ¨¡å— | è§£è€¦ |

---

### 2.2 è½®è¯¢ vs äº‹ä»¶é©±åŠ¨

**Q: ä½ æåˆ°æ—§ç‰ˆæœ‰"1 ç§’è½®è¯¢ active tasks"çš„é—®é¢˜ï¼Œå…·ä½“ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚æœè®©ä½ ä¼˜åŒ–è½®è¯¢æ–¹æ¡ˆï¼ˆä¸é‡æ„ï¼‰ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼ˆ95åˆ†ç‰ˆæœ¬ï¼‰ï¼š**

> "è½®è¯¢æ–¹æ¡ˆæœ‰ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
>
> **ç¬¬ä¸€ï¼Œå“åº”å»¶è¿Ÿã€‚** 1ç§’è½®è¯¢ç²’åº¦æ„å‘³ç€ä»»åŠ¡ A å®Œæˆåï¼Œä¾èµ–å®ƒçš„ä»»åŠ¡ B æœ€å¤šè¦ç­‰ 1 ç§’æ‰èƒ½å¯åŠ¨ã€‚åœ¨é•¿é“¾è·¯åœºæ™¯ï¼ˆå¦‚ Storyboard â†’ ImageÃ—5 â†’ Composeï¼‰ä¸­ï¼Œç´¯ç§¯å»¶è¿Ÿä¼šè¾¾åˆ° 5-10 ç§’ã€‚
>
> **ç¬¬äºŒï¼ŒO(n) æ— æ•ˆéå†ã€‚** æ¯æ¬¡è½®è¯¢éƒ½è¦æ£€æŸ¥æ‰€æœ‰ active tasksï¼Œå³ä½¿ 99% çš„ä»»åŠ¡çŠ¶æ€æ²¡å˜ï¼ˆæ¯”å¦‚è¿˜åœ¨ç­‰ç½‘ç»œå“åº”ï¼‰ã€‚å½“å¹¶å‘ 100 ä¸ªä»»åŠ¡æ—¶ï¼Œæ¯ç§’è¦åš 100 æ¬¡çŠ¶æ€æ£€æŸ¥ï¼ŒCPU æµªè´¹åœ¨æ— æ„ä¹‰çš„éå†ä¸Šã€‚
>
> **ç¬¬ä¸‰ï¼Œä¼˜å…ˆçº§æ— æ³•å®æ—¶å“åº”ã€‚** å³ä½¿å¼•å…¥ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œè½®è¯¢é—´éš”å†…é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¹Ÿå¾—ç­‰ã€‚
>
> **å¦‚æœåªèƒ½åœ¨è½®è¯¢ä¸Šä¼˜åŒ–ï¼Œæˆ‘ä¼šï¼š**
> 1. ç¼©çŸ­é—´éš”åˆ° 100msï¼ˆä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œä¸” CPU å ç”¨ä¸Šå‡ 10 å€ï¼‰
> 2. æŒ‰çŠ¶æ€åˆ†æ¡¶ç´¢å¼•ï¼ˆåªè½®è¯¢ Pending/Runningï¼Œè·³è¿‡ Succeeded/Failedï¼‰
> 3. åŠ å…¥è‡ªé€‚åº”é—´éš”ï¼ˆæ— ä»»åŠ¡æ—¶é€€é¿åˆ° 5sï¼Œæœ‰ä»»åŠ¡æ—¶ç¼©çŸ­åˆ° 100msï¼‰
> 4. å¼•å…¥ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆä¼˜å…ˆè½®è¯¢é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼‰
>
> **ä½†è¿™äº›éƒ½æ˜¯æƒå®œä¹‹è®¡ã€‚** è½®è¯¢çš„æœ¬è´¨æ˜¯ **'è¢«åŠ¨æ¢æµ‹'**ï¼Œè€Œæ­£ç¡®çš„æ–¹æ¡ˆæ˜¯ **'ä¸»åŠ¨é€šçŸ¥'**ï¼šä»»åŠ¡å®Œæˆæ—¶è§¦å‘å›è°ƒï¼Œç›´æ¥å”¤é†’ä¾èµ–ä»»åŠ¡ã€‚è¿™æ ·å¤æ‚åº¦ä» O(n) é™åˆ° O(å‡ºåº¦)ï¼Œå»¶è¿Ÿä»ç§’çº§é™åˆ°æ¯«ç§’çº§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©é‡æ„ã€‚"

#### ğŸ“ è½®è¯¢ vs äº‹ä»¶é©±åŠ¨å¯¹æ¯”è¡¨ï¼ˆå¿…èƒŒï¼‰

| ç»´åº¦ | è½®è¯¢ | äº‹ä»¶é©±åŠ¨ |
|------|------|----------|
| **å“åº”å»¶è¿Ÿ** | æœ€å¤š 1 ä¸ªè½®è¯¢å‘¨æœŸï¼ˆå¦‚ 1sï¼‰ | å¾®ç§’çº§ï¼ˆç«‹å³è§¦å‘å›è°ƒï¼‰ |
| **CPU å¼€é”€** | O(n) éå†æ‰€æœ‰ä»»åŠ¡ | O(å‡ºåº¦) åªå”¤é†’ä¾èµ–ä»»åŠ¡ |
| **æ— æ•ˆæ£€æŸ¥** | 99% çš„è½®è¯¢æ— æ„ä¹‰ | æ— æ— æ•ˆæ£€æŸ¥ |
| **å®ç°å¤æ‚åº¦** | ç®€å•ï¼ˆä¸€ä¸ª for å¾ªç¯ï¼‰ | å¤æ‚ï¼ˆéœ€è¦å›è°ƒæœºåˆ¶ï¼‰ |
| **å¯æ‰©å±•æ€§** | ä»»åŠ¡è¶Šå¤šè¶Šæ…¢ | ä»»åŠ¡å¤šå°‘å½±å“ä¸å¤§ |

---

### 2.3 RetryableHttpClient æ·±æŒ–

**Q: å‡è®¾ç”¨æˆ·ç½‘ç»œå¾ˆå·®ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚è¶…æ—¶äº†ã€‚ä½ çš„ä»£ç ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿå¦‚æœ `max_retries=3`ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ `inner_->execute()` å‡ æ¬¡ï¼Ÿæ€»è€—æ—¶å¤§çº¦å¤šå°‘ï¼Ÿ**

**æ ‡å‡†ç­”æ¡ˆï¼ˆ95åˆ†ç‰ˆæœ¬ï¼‰ï¼š**

> "æˆ‘æ¥é€æ­¥æè¿°æ‰§è¡Œæµç¨‹ï¼š
>
> **åˆå§‹çŠ¶æ€ï¼š** `attempt = 0`ï¼Œ`backoff = 1000ms`ï¼ˆ1ç§’ï¼‰ã€‚
>
> **ç¬¬1æ¬¡è°ƒç”¨ï¼ˆåˆæ¬¡å°è¯•ï¼‰ï¼š**
> - L73ï¼šè°ƒç”¨ `inner_->execute()`ï¼Œè¿”å› TIMEOUT é”™è¯¯
> - L84-93ï¼šä» `error.details` æå– `http_code = 1002`ï¼ˆTIMEOUTï¼‰
> - L96-97ï¼šåˆ¤æ–­ `should_retry = true`ï¼ˆTIMEOUTå¯é‡è¯•ï¼‰ï¼Œ`has_attempts_left = (0 < 3) = true`
> - L107ï¼šæ‰“å°æ—¥å¿— `[trace_id] Retry attempt 1/3, backoff=1000ms`
> - L114-123ï¼šåˆ†ç‰‡ sleep 1ç§’ï¼ˆæ¯ 100ms æ£€æŸ¥ä¸€æ¬¡å–æ¶ˆï¼‰
> - L127-131ï¼šæ›´æ–° `backoff = 2000ms`ï¼Œ`attempt = 1`
>
> **ç¬¬2æ¬¡è°ƒç”¨ï¼ˆç¬¬1æ¬¡é‡è¯•ï¼‰ï¼š**
> - åˆå¤±è´¥ â†’ sleep 2ç§’ â†’ `backoff = 4000ms`ï¼Œ`attempt = 2`
>
> **ç¬¬3æ¬¡è°ƒç”¨ï¼ˆç¬¬2æ¬¡é‡è¯•ï¼‰ï¼š**
> - åˆå¤±è´¥ â†’ sleep 4ç§’ â†’ `backoff = 8000ms`ï¼Œ`attempt = 3`
>
> **ç¬¬4æ¬¡è°ƒç”¨ï¼ˆç¬¬3æ¬¡é‡è¯•ï¼Œæœ€åæœºä¼šï¼‰ï¼š**
> - L97ï¼š`has_attempts_left = (3 < 3) = false`ï¼ˆå…³é”®åˆ¤æ–­ï¼ï¼‰
> - L100ï¼šä¸æ»¡è¶³é‡è¯•æ¡ä»¶ï¼Œè¿”å›é”™è¯¯
>
> **æ€»ç»“ï¼š**
> - **æ€»è°ƒç”¨æ¬¡æ•°ï¼š4æ¬¡**ï¼ˆ1æ¬¡åˆå§‹ + 3æ¬¡é‡è¯•ï¼Œç¬¦åˆ `max_retries=3`ï¼‰
> - **æ€»sleepæ—¶é—´ï¼š~7ç§’**ï¼ˆ1s + 2s + 4sï¼ŒæŒ‡æ•°é€€é¿ï¼‰
> - **attempt è¯­ä¹‰ï¼šä»£è¡¨'å·²é‡è¯•æ¬¡æ•°'**ï¼Œä»0å¼€å§‹
> - **æ€»è€—æ—¶ï¼š~7ç§’ + 4æ¬¡è¯·æ±‚è€—æ—¶**ï¼ˆå¦‚æœæ¯æ¬¡è¶…æ—¶30sï¼Œæ€»å…±~127ç§’ï¼‰
>
> **å…³é”®ç»†èŠ‚ï¼š** ç¬¬4æ¬¡å¤±è´¥åä¸ä¼šå† sleepï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼Œå› ä¸º `attempt` å·²ç»æ˜¯ 3ã€‚"

#### ğŸ“Š å˜é‡å˜åŒ–è¡¨ï¼ˆå¿…èƒŒï¼‰

| å¾ªç¯è½®æ¬¡ | attempt | backoff | æ˜¯å¦è°ƒç”¨ execute | sleepæ—¶é—´ | has_attempts_left |
|---------|---------|---------|-----------------|-----------|-------------------|
| ç¬¬1è½® | 0 | 1000ms | âœ… ç¬¬1æ¬¡è°ƒç”¨ | 1000ms | 0 < 3 âœ… |
| ç¬¬2è½® | 1 | 2000ms | âœ… ç¬¬2æ¬¡è°ƒç”¨ | 2000ms | 1 < 3 âœ… |
| ç¬¬3è½® | 2 | 4000ms | âœ… ç¬¬3æ¬¡è°ƒç”¨ | 4000ms | 2 < 3 âœ… |
| ç¬¬4è½® | 3 | 8000ms | âœ… ç¬¬4æ¬¡è°ƒç”¨ | - | 3 < 3 âŒ |

#### âš ï¸ æ˜“é”™ç‚¹

1. **æ€»è°ƒç”¨æ¬¡æ•°**ï¼šä¸æ˜¯ 3 æ¬¡ï¼Œæ˜¯ **4 æ¬¡**ï¼ˆ1 + max_retriesï¼‰
2. **attempt è¯­ä¹‰**ï¼šæ˜¯"å·²é‡è¯•æ¬¡æ•°"ï¼Œä¸æ˜¯"ç¬¬å‡ æ¬¡å°è¯•"
3. **æ€»è€—æ—¶**ï¼šåˆ«å¿˜äº† sleep æ—¶é—´ï¼ˆ1+2+4=7ç§’ï¼‰

---

## Part 3: å…«è‚¡å¿«é—®å¿«ç­”

### 3.1 C++ åŸºç¡€

**Q1: C++ è™šå‡½æ•°çš„åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿè™šå‡½æ•°è¡¨æŒ‡é’ˆå­˜åœ¨å“ªé‡Œï¼Ÿ**

**A:**
- æ¯ä¸ªæœ‰è™šå‡½æ•°çš„ç±»æœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰ï¼Œå­˜å‚¨è™šå‡½æ•°åœ°å€
- å¯¹è±¡å†…å­˜å¸ƒå±€æœ€å¼€å§‹æ˜¯è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼ˆvptrï¼‰ï¼ŒæŒ‡å‘ vtable
- è°ƒç”¨è™šå‡½æ•°æ—¶ï¼šé€šè¿‡ vptr æ‰¾åˆ° vtableï¼Œå†é€šè¿‡åç§»æ‰¾åˆ°å‡½æ•°åœ°å€
- vptr å­˜åœ¨å¯¹è±¡å†…å­˜çš„å¼€å¤´ï¼ˆç¼–è¯‘å™¨å®ç°ï¼Œé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªæˆå‘˜ï¼‰

**Q2: æ™ºèƒ½æŒ‡é’ˆ `shared_ptr` å’Œ `unique_ptr` çš„åŒºåˆ«ï¼Ÿ**

**A:**

| ç‰¹æ€§ | `shared_ptr` | `unique_ptr` |
|------|--------------|--------------|
| æ‰€æœ‰æƒ | å…±äº«ï¼ˆå¼•ç”¨è®¡æ•°ï¼‰ | ç‹¬å ï¼ˆä¸å¯æ‹·è´ï¼‰ |
| æ€§èƒ½ | æœ‰å¼€é”€ï¼ˆåŸå­æ“ä½œï¼‰ | é›¶å¼€é”€ï¼ˆç¼–è¯‘æœŸä¼˜åŒ–ï¼‰ |
| å¤§å° | 2ä¸ªæŒ‡é’ˆï¼ˆå¯¹è±¡ + æ§åˆ¶å—ï¼‰ | 1ä¸ªæŒ‡é’ˆ |
| ç§»åŠ¨ | å¯æ‹·è´å¯ç§»åŠ¨ | åªèƒ½ç§»åŠ¨ |

---

### 3.2 æ“ä½œç³»ç»Ÿ

**Q1: è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ**

**A:**
- è¿›ç¨‹ï¼šèµ„æºåˆ†é…å•ä½ï¼ˆç‹¬ç«‹åœ°å€ç©ºé—´ã€æ–‡ä»¶æè¿°ç¬¦ï¼‰
- çº¿ç¨‹ï¼šè°ƒåº¦å•ä½ï¼ˆå…±äº«åœ°å€ç©ºé—´ï¼Œç‹¬ç«‹æ ˆï¼‰
- è¿›ç¨‹é—´é€šä¿¡éœ€ IPCï¼ˆç®¡é“ã€å…±äº«å†…å­˜ã€socketï¼‰
- çº¿ç¨‹é—´é€šä¿¡ç›´æ¥è®¿é—®å…±äº«å†…å­˜ï¼ˆéœ€åŒæ­¥ï¼‰

**Q2: Linux è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æœ‰å“ªäº›æ–¹å¼ï¼Ÿå“ªç§æœ€å¿«ï¼Ÿ**

**A:**
- ç®¡é“ï¼ˆpipeï¼‰ã€å‘½åç®¡é“ï¼ˆFIFOï¼‰
- å…±äº«å†…å­˜ï¼ˆæœ€å¿«ï¼Œæ— æ‹·è´ï¼‰
- æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmqï¼‰
- ä¿¡å·é‡ï¼ˆsemaphoreï¼‰
- Socketï¼ˆç½‘ç»œé€šä¿¡ï¼‰
- Unix Domain Socketï¼ˆæœ¬åœ°è¿›ç¨‹é—´ï¼Œæ¯”ç½‘ç»œ socket å¿«ï¼‰

**æœ€å¿«çš„æ˜¯å…±äº«å†…å­˜**ï¼Œå› ä¸ºæ— éœ€æ•°æ®æ‹·è´ï¼Œä½†éœ€è¦é¢å¤–çš„åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ä¿¡å·é‡ï¼‰ã€‚

---

### 3.3 ç½‘ç»œ

**Q1: TCP çš„æ‹¥å¡æ§åˆ¶ç®—æ³•æœ‰å“ªå‡ ç§ï¼Ÿç®€å•è¯´è¯´æ…¢å¯åŠ¨ã€‚**

**A:**
- **å››ä¸ªç®—æ³•**ï¼šæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ ã€å¿«æ¢å¤
- **æ…¢å¯åŠ¨**ï¼š
  - åˆå§‹ cwndï¼ˆæ‹¥å¡çª—å£ï¼‰= 1 MSS
  - æ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼Œcwnd ç¿»å€ï¼ˆæŒ‡æ•°å¢é•¿ï¼‰
  - è¾¾åˆ° ssthreshï¼ˆæ…¢å¯åŠ¨é˜ˆå€¼ï¼‰åï¼Œè¿›å…¥æ‹¥å¡é¿å…ï¼ˆçº¿æ€§å¢é•¿ï¼‰
  - ä¸¢åŒ…æ—¶ï¼šssthresh = cwnd/2ï¼Œé‡æ–°æ…¢å¯åŠ¨

**Q2: HTTP/1.1 å’Œ HTTP/2 çš„ä¸»è¦åŒºåˆ«ï¼Ÿ**

**A:**
- **HTTP/1.1**ï¼š
  - ä¸²è¡Œè¯·æ±‚ï¼ˆé˜Ÿå¤´é˜»å¡ï¼‰
  - æ–‡æœ¬åè®®ï¼Œå¤´éƒ¨é‡å¤
  - æ¯ä¸ªè¯·æ±‚ä¸€ä¸ª TCP è¿æ¥ï¼ˆæˆ–æœ‰é™å¤ç”¨ï¼‰

- **HTTP/2**ï¼š
  - å¤šè·¯å¤ç”¨ï¼ˆä¸€ä¸ªè¿æ¥å¤šä¸ªæµï¼‰
  - äºŒè¿›åˆ¶åè®®ï¼Œå¤´éƒ¨å‹ç¼©ï¼ˆHPACKï¼‰
  - æœåŠ¡ç«¯æ¨é€ï¼ˆServer Pushï¼‰

---

## Part 4: 72å°æ—¶å¤ä¹ è®¡åˆ’

### Day 1ï¼ˆ8å°æ—¶ï¼‰

**08:00-12:00ï¼šPart 1.1 å¼‚å¸¸å®‰å…¨ï¼ˆ4hï¼‰**
- [ ] é˜…è¯» `from_chars` vs `stoi` å¯¹æ¯”è¡¨
- [ ] é»˜å†™ä»£ç ç¤ºä¾‹ï¼ˆparse_http_code_safeï¼‰
- [ ] èƒŒæ ‡å‡†ç­”æ¡ˆï¼ˆå½•éŸ³ï¼Œåå¤å¬ï¼‰
- [ ] åšç»ƒä¹ ï¼šç”¨ from_chars è§£æ `"999999999999999"` çœ‹è¿”å›ä»€ä¹ˆ

**14:00-17:00ï¼šPart 1.2 æ™ºèƒ½æŒ‡é’ˆï¼ˆ3hï¼‰**
- [ ] ç†è§£ä¸‰å±‚çº¿ç¨‹å®‰å…¨æ¨¡å‹
- [ ] é»˜å†™ safe_scenario / unsafe_scenario ä»£ç 
- [ ] åšç»ƒä¹ ï¼šå†™ä¸€ä¸ªå…¨å±€ shared_ptrï¼Œæ¨¡æ‹Ÿç«æ€æ¡ä»¶

**19:00-20:00ï¼šå¤ä¹ æµ‹è¯•ï¼ˆ1hï¼‰**
- [ ] é—­å·å›ç­”ï¼šfrom_chars ä¸ºä»€ä¹ˆå¥½ï¼Ÿ
- [ ] é—­å·å›ç­”ï¼šshared_ptr ä¸‰å±‚æ¨¡å‹

---

### Day 2ï¼ˆ8å°æ—¶ï¼‰

**08:00-11:00ï¼šPart 1.3 å¤šçº¿ç¨‹åŸºç¡€ï¼ˆ3hï¼‰**
- [ ] é»˜å†™ safe_log_v1 / safe_log_v2 ä»£ç 
- [ ] èƒŒä¸‰ç§é”çš„åŒºåˆ«è¡¨
- [ ] åšç»ƒä¹ ï¼šæµ‹è¯• printf æ··ä¹±è¾“å‡º

**14:00-16:00ï¼šPart 1.4 chrono æ—¶é—´åº“ï¼ˆ2hï¼‰**
- [ ] é»˜å†™æŒ‡æ•°é€€é¿è®¡ç®—ä»£ç 
- [ ] ç†è§£ duration_cast çš„å¿…è¦æ€§

**16:00-18:00ï¼šPart 2 é¡¹ç›®é¢è¯•é¢˜ï¼ˆ2hï¼‰**
- [ ] èƒŒé‡æ„åŠ¨æœºæ ‡å‡†ç­”æ¡ˆ
- [ ] èƒŒè½®è¯¢ vs äº‹ä»¶é©±åŠ¨å¯¹æ¯”è¡¨
- [ ] æ¨¡æ‹Ÿè®²è§£ï¼šRetryableHttpClient æ‰§è¡Œæµç¨‹

**19:00-20:00ï¼šæ¨¡æ‹Ÿé¢è¯•ï¼ˆ1hï¼‰**
- [ ] å½•éŸ³å›ç­” Part 2 çš„ 3 ä¸ªé—®é¢˜
- [ ] å¬å½•éŸ³ï¼Œæ‰¾å‡º"å—¯ã€å•Šã€é‚£ä¸ª"ç­‰åºŸè¯
- [ ] é‡æ–°ç»„ç»‡è¯­è¨€ï¼Œå†å½•ä¸€é

---

### Day 3ï¼ˆ4å°æ—¶ï¼Œè€ƒå‰çªå‡»ï¼‰

**08:00-10:00ï¼šå¿«é€Ÿè¿‡ä¸€éæ‰€æœ‰"æ ‡å‡†ç­”æ¡ˆ"**
- [ ] æ¯ä¸ªé—®é¢˜ 2 åˆ†é’Ÿï¼Œä¸çœ‹ç­”æ¡ˆå£è¿°
- [ ] é”™çš„åœ°æ–¹é‡ç‚¹å¤ä¹ 

**10:00-12:00ï¼šåˆ· LeetCode ä¸­ç­‰é¢˜ 2 é“**
- [ ] ä¿æŒæ‰‹æ„Ÿï¼ˆé“¾è¡¨ã€äºŒå‰æ ‘å„ä¸€é“ï¼‰

---

## ğŸ“Œ é™„å½•ï¼šæ¦‚å¿µçº æ­£

### âŒ å¸¸è§é”™è¯¯æ¦‚å¿µ

1. **åƒµå°¸è¿›ç¨‹**
   - é”™è¯¯ç†è§£ï¼šä»»åŠ¡å¡æ­»
   - æ­£ç¡®å®šä¹‰ï¼šå­è¿›ç¨‹å·²é€€å‡ºä½†çˆ¶è¿›ç¨‹æœª wait() å›æ”¶

2. **å¼‚å¸¸å¤„ç†**
   - é”™è¯¯ï¼šè®¤ä¸º from_chars è¿”å›å¼‚å¸¸
   - æ­£ç¡®ï¼šfrom_chars ä¸æŠ›å¼‚å¸¸ï¼Œè¿”å›é”™è¯¯ç 

3. **shared_ptr çº¿ç¨‹å®‰å…¨**
   - é”™è¯¯ï¼šè®¤ä¸ºå¤šçº¿ç¨‹å¯ä»¥éšä¾¿ç”¨
   - æ­£ç¡®ï¼šåªæœ‰å¼•ç”¨è®¡æ•°çº¿ç¨‹å®‰å…¨ï¼Œå¯¹è±¡æœ¬èº«éœ€è¦åŒæ­¥

---

## ğŸ¯ è€ƒå‰ 30 åˆ†é’Ÿæ£€æŸ¥æ¸…å•

- [ ] from_chars ä¸‰ä¸ªä¼˜åŠ¿èƒ½èƒŒå‡ºæ¥
- [ ] shared_ptr ä¸‰å±‚æ¨¡å‹èƒ½ç”»å‡ºæ¥
- [ ] printf ä¸å®‰å…¨çš„åŸå› èƒ½è®²æ¸…æ¥š
- [ ] è½®è¯¢ vs äº‹ä»¶é©±åŠ¨å¯¹æ¯”è¡¨è®°ä½äº†
- [ ] RetryableHttpClient æ‰§è¡Œæµç¨‹èƒ½ä¸€éè¿‡
- [ ] é¡¹ç›®é‡æ„åŠ¨æœºçš„é‡åŒ–æ•°æ®ï¼ˆ15% â†’ 2% CPUï¼‰è®°ä½äº†

---

**æœ€åæé†’ï¼šé¢è¯•æ—¶é‡åˆ°ä¸ä¼šçš„é¢˜ï¼Œä¸è¦æ…Œã€‚å¯ä»¥è¯´"è¿™ä¸ªé—®é¢˜æˆ‘éœ€è¦æƒ³ä¸€ä¸‹"ï¼Œç„¶åç”¨ STAR æ³•åˆ™ï¼ˆèƒŒæ™¯-ä»»åŠ¡-è¡ŒåŠ¨-ç»“æœï¼‰ç»„ç»‡è¯­è¨€ã€‚è¯šå®æ¯”ç¡¬ç¼–ç­”æ¡ˆæ›´é‡è¦ã€‚**

**Good Luck! ğŸ’ª**
